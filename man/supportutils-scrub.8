.TH SUPPORTUTILS-SCRUB 8 "23 Feb 2026" "supportutils-scrub 1.2" "Support Utilities Manual"
.SH NAME
supportutils-scrub \- Obfuscate sensitive data from SUSE supportconfig tarballs and network packet captures
.SH SYNOPSIS
.B supportutils-scrub
\fITARGET\fR [\fIOPTIONS\fR]
.br
.B supportutils-scrub
\fIARCHIVE1.txz\fR \fIARCHIVE2.txz\fR [\fIARCHIVE3.txz\fR ...] [\fIOPTIONS\fR]
.br
.B cat
\fIlogfile\fR |
.B supportutils-scrub
[\fIOPTIONS\fR]
.br
.B supportutils-scrub
\fB\-\fR [\fIOPTIONS\fR]
.br
.B supportutils-scrub
\fB\-\-rewrite\-pcap\fR \fB\-\-mappings\fR \fIFILE\fR \fB\-\-pcap\-in\fR \fIFILES\fR [\fIOPTIONS\fR]
.SH DESCRIPTION
\fBsupportutils-scrub\fR is a utility designed to sanitize and remove sensitive or unwanted data from SUSE supportconfig tarballs, directories, plain log files, and network packet captures. This tool assists users and organizations in aligning with data protection policies, privacy requirements, and GDPR compliance standards.

The tool supports the following input modes:

.TP
.B Archive mode (single)
Processes a single \fI.txz\fR or \fI.tgz\fR supportconfig tarball. An obfuscated copy is written as \fI*_scrubbed.txz\fR alongside the original.

.TP
.B Archive mode (multi)
Processes two or more archives in a single run. Mappings are automatically chained: any IP address, hostname, domain, or username seen in the first archive is given the same fake value in all subsequent archives. This is the recommended way to handle HA clusters (e.g., node1 + node2 + crm_report).

.TP
.B Folder mode
Processes any directory. A copy is created at \fI{dir}_scrubbed/\fR and files are scrubbed in-place inside that copy. No repacking is performed.

.TP
.B Single file mode
Processes a plain text file (not a tarball). The scrubbed output is written to \fI{file}_scrubbed\fR.

.TP
.B Stdin/pipe mode
Reads from standard input and writes the scrubbed text to standard output. Header and summary are sent to standard error. Activated automatically when no path is given and stdin is not a terminal, or when \fB\-\fR is passed as the path.

.TP
.B PCAP mode
Rewrites packet capture files using the same subnet-aware mappings from supportconfig obfuscation, ensuring consistency between log files and network traces.

All obfuscations are performed consistently, ensuring that sensitive information such as IP addresses, domain names, usernames, hostnames, IPv6 addresses, and MAC addresses are replaced uniformly. The obfuscation mappings are saved in \fI/var/tmp/obfuscation_mappings_*.json\fR and can be reused to maintain consistency across separate runs.

.SH FEATURES
.IP \(bu 2
\fBMultiple input modes:\fR Archives, folders, plain files, stdin/pipe, multi-archive.
.IP \(bu 2
\fBSubnet-Aware IP Mapping:\fR Maps whole IPv4 subnets to fake subnets while preserving host offsets (e.g., gateway .1 remains .1 in the mapped subnet).
.IP \(bu 2
\fBAutomatic entity detection:\fR In pipe/file/stdin modes the tool pre-scans the text to auto-detect usernames (PAM log patterns, logname= fields), hostnames (NFS server lines, RFC\~5424 syslog), and domains (FQDN extraction with TLD validation).
.IP \(bu 2
\fBConsistent multi-archive obfuscation:\fR Shared mappings across all archives in one run.
.IP \(bu 2
\fBtcprewrite Integration:\fR Exports mappings compatible with tcprewrite for pcap file obfuscation.
.IP \(bu 2
\fBSafe by Default:\fR Original files are never modified; obfuscated versions are created separately.

.SH OPTIONS
.SS General Options
.TP
\fB\-\-config\fR \fIPATH\fR
Specify the path to the configuration file. Defaults to \fI/etc/supportutils-scrub/supportutils-scrub.conf\fR.
.TP
\fB\-\-verbose\fR
Enable verbose output with more detailed logging information.
.TP
\fB\-\-mappings\fR \fIFILE\fR
Load an existing obfuscation mapping file before processing. Ensures that any previously assigned fake values are reused for consistency.

.SS Obfuscation Options
.TP
\fB\-\-domain\fR \fIDOMAINS\fR
Comma, semicolon, or space-separated list of additional domain names to obfuscate.
.TP
\fB\-\-username\fR \fIUSERNAMES\fR
Comma, semicolon, or space-separated list of additional usernames to obfuscate.
.TP
\fB\-\-hostname\fR \fIHOSTNAMES\fR
Comma, semicolon, or space-separated list of additional hostnames to obfuscate.
.TP
\fB\-\-keywords\fR \fIKEYWORDS\fR
Comma, semicolon, or space-separated list of keywords to obfuscate. Keywords are replaced in both standalone and substring matches.
.TP
\fB\-\-keyword\-file\fR \fIFILE\fR
File containing keywords to obfuscate, one per line.

.SS PCAP Options
.TP
\fB\-\-rewrite\-pcap\fR
Enable PCAP rewriting mode using subnet mappings from the JSON mapping file.
.TP
\fB\-\-pcap\-in\fR \fIFILES\fR
One or more input PCAP files to obfuscate.
.TP
\fB\-\-pcap\-out\-dir\fR \fIDIR\fR
Output directory for obfuscated PCAP files (default: current directory).
.TP
\fB\-\-print\-tcprewrite\fR
Print the exact tcprewrite command being executed (useful for debugging).

.SH EXAMPLES
.SS Single archive
.TP
\fBsupportutils-scrub\fR /var/log/scc_node1.txz
Processes the tarball and writes \fIscc_node1_scrubbed.txz\fR.
.TP
\fBsupportutils-scrub\fR /var/log/scc_node1.txz \-\-domain example.com \-\-verbose
Scrubs the archive, additionally replacing all occurrences of \fIexample.com\fR and its subdomains.

.SS Multiple archives (HA cluster)
.TP
\fBsupportutils-scrub\fR scc_node1.txz scc_node2.txz crm_report.txz
Processes all three archives in one run. Mappings are chained automatically: any IP, hostname, or username seen in node1 receives the same fake value in node2 and the crm_report. A single mapping file is written at the end.

.SS Folder mode
.TP
\fBsupportutils-scrub\fR /var/log/scc_extracted/
Copies the directory to \fI/var/log/scc_extracted_scrubbed/\fR and scrubs all files in-place.

.SS Single file mode
.TP
\fBsupportutils-scrub\fR /var/log/messages
Scrubs the file and writes the result to \fI/var/log/messages_scrubbed\fR.

.SS Stdin/pipe mode
.TP
\fBjournalctl \-u sshd | supportutils-scrub\fR
Scrubs the journal output; scrubbed text goes to stdout, summary to stderr.
.TP
\fBsupportutils-scrub \-\fR < /var/log/messages
Explicitly reads from stdin using the dash argument.
.TP
\fBsupportutils-scrub \-\-domain corp.com < /var/log/auth.log > auth_scrubbed.log\fR
Scrubs auth.log and saves result to a file.

.SS PCAP Obfuscation
.TP
\fBsupportutils-scrub\fR \-\-rewrite\-pcap \-\-mappings /var/tmp/obfuscation_mappings_20260223_120000.json \-\-pcap\-in trace.pcap
Rewrites a single pcap file using existing mappings from a supportconfig obfuscation.
.TP
\fBsupportutils-scrub\fR \-\-rewrite\-pcap \-\-mappings mappings.json \-\-pcap\-in trace1.pcap trace2.pcap \-\-pcap\-out\-dir /var/log/
Rewrites multiple pcap files and saves them to \fI/var/log/\fR.

.SH PCAP REWRITING DETAILS
.SS Subnet-Aware Mapping
.IP \(bu 2
Whole IPv4 subnets are mapped to fake subnets
.IP \(bu 2
Host offsets are preserved (e.g., .1 remains .1, .254 remains .254)
.IP \(bu 2
Most-specific subnet rules are applied first
.IP \(bu 2
Original pcap files are never modified

.SS Requirements
.IP \(bu 2
tcprewrite tool must be installed (package: tcpreplay)
.IP \(bu 2
PCAPs should be captured on specific interfaces (e.g., \-i eth0), not \-i any
.IP \(bu 2
Only IPv4 addresses are rewritten (IPv6 support pending)

.SS Troubleshooting PCAP Rewriting
.TP
.B "No DLT plugin available" error
The PCAP was likely captured with \fBtcpdump \-i any\fR. Re-capture on a specific interface or normalize the link type:
.br
\fBtcprewrite\fR --dlt=enet -i in.pcap -o in-enet.pcap
.TP
.B "Unable to parse as a valid CIDR" error
Ensure the mapping file's subnet entries are valid IPv4 CIDRs.
.TP
.B Empty or unchanged output
If packets don't match any mapped subnets, addresses remain unchanged. Verify with:
.br
\fBtshark\fR -r trace_scrubbed.pcap -c 5 -T fields -e ip.src -e ip.dst | column -t

.SH FILES
.I /etc/supportutils-scrub/supportutils-scrub.conf
.RS
Default configuration file. See
.BR supportutils-scrub.conf (5)
for details.
.RE
.I /var/tmp/obfuscation_mappings_*.json
.RS
JSON files containing obfuscation mappings. These files map real data to obfuscated data and must be kept secure. The subnet section is used for tcprewrite operations.
.RE

.SH SECURITY CONSIDERATIONS
.IP \(bu 2
\fBNEVER\fR share the mapping file with SUSE Support or any third party. It contains the translation between obfuscated and real data.
.IP \(bu 2
The obfuscation process is the customer's responsibility. Always review the obfuscated output before sharing.
.IP \(bu 2
Keywords are replaced even within words (substring matching) for thorough obfuscation.

.SH AUTHOR
Ronald Pina <ronald.pina@suse.com>
.SH COPYRIGHT
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; version 2 of the License.
.PP
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
.PP
You should have received a copy of the GNU General Public License
along with this program; if not, see <http://www.gnu.org/licenses/>.

.SH SEE ALSO
.BR supportutils-scrub.conf (5),
.BR supportconfig (8),
.BR tcprewrite (1),
.BR tcpreplay (1)
